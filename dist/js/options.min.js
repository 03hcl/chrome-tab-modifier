var app=angular.module("TabModifier",["ngRoute","ngAnimate","ngMaterial"]);app.config(["$routeProvider","$compileProvider","$mdIconProvider","$mdThemingProvider",function(e,t,n,o){t.aHrefSanitizationWhitelist(/^\s*(blob|http|https|chrome-extension):/),n.icon("alert","/icons/alert.svg").icon("file-import","/icons/file-import.svg").icon("file-export","/icons/file-export.svg").icon("file-outline","/icons/file-outline.svg").icon("options-vertical","/icons/dots-vertical.svg").icon("close","/icons/close.svg").icon("plus","/icons/plus.svg").icon("image","/icons/image.svg").icon("save","/icons/content-save.svg").icon("tab","/icons/checkbox-multiple-marked-outline.svg").icon("list","/icons/format-list-bulleted.svg").icon("tab","/icons/tab.svg").icon("list-plus","/icons/playlist-plus.svg").icon("clear","/icons/eraser.svg").icon("settings","/icons/settings.svg").icon("duplicate","/icons/content-copy.svg").icon("delete","/icons/delete.svg").icon("edit","/icons/pencil.svg").icon("google-chrome","/icons/google-chrome.svg").icon("github-circle","/icons/github-circle.svg").icon("help","/icons/help-circle.svg"),o.theme("default").primaryPalette("blue-grey",{"default":"500"}).accentPalette("pink",{"default":"400"}).warnPalette("red",{"default":"500"});var i={"/":{templateUrl:"/html/tab_rules.min.html",controller:"TabRulesController"},"/settings":{templateUrl:"/html/settings.min.html",controller:"SettingsController"},"/help":{templateUrl:"/html/help.min.html",controller:"HelpController"}};for(var l in i)i.hasOwnProperty(l)&&e.when(l,i[l])}]),app.run(["$rootScope","$location",function(e,t){e.location=t}]),app.directive("onReadFile",["$parse",function(e){return{restrict:"A",scope:!1,link:function(t,n,o){var i=e(o.onReadFile);n.on("change",function(e){var n=new FileReader;n.onload=function(e){t.$apply(function(){i(t,{$fileContent:e.target.result})})},n.readAsText((e.srcElement||e.target).files[0])})}}}]),app.directive("inputFileButton",function(){return{restrict:"E",link:function(e,t,n){var o=t.find("button"),i=t.find("input");i.css({display:"none"}),o.bind("click",function(){i[0].click()})}}}),app.factory("TabModifier",["Rule",function(e){var t=function(e){this.rules=[],angular.extend(this,e)};return t.prototype.setModel=function(e){angular.extend(this,e)},t.prototype.addRule=function(e){this.rules.push(e)},t.prototype.removeRule=function(e){this.rules.splice(this.rules.indexOf(e),1),this.setLocalData()},t.prototype.save=function(e,t){null===t||void 0===t?this.addRule(e):this.rules[t]=e,this.setLocalData()},t.prototype.build=function(t){var n=this;this.rules=[],angular.forEach(t.rules,function(t){n.addRule(new e(t))})},t.prototype.getLocalData=function(){void 0!==localStorage.tab_modifier&&this.build(JSON.parse(localStorage.tab_modifier))},t.prototype.setLocalData=function(){localStorage.tab_modifier=JSON.stringify(this)},t.prototype.checkOldSettings=function(){var t,n,o=this,i=0;if(void 0!==localStorage.settings){this.rules=[],t=JSON.parse(localStorage.settings);for(var l in t)t.hasOwnProperty(l)&&(n=new e({name:"Rule "+(i+1),url_fragment:l,tab:{title:t[l].title||null,icon:t[l].icon||null,pinned:t[l].pinned||!1,"protected":t[l]["protected"]||!1,unique:t[l].unique||!1,muted:t[l].muted||!1,url_matcher:t[l].url_matcher||null}}),o.addRule(n)),i++;this.setLocalData(),localStorage.removeItem("settings")}},t.prototype["import"]=function(e){try{var t=JSON.parse(e);if(console.log(t),"rules"in t==!1)return"INVALID_SETTINGS"}catch(n){return"INVALID_JSON_FORMAT"}return localStorage.tab_modifier=e,!0},t.prototype["export"]=function(){var e=new Blob([JSON.stringify(this,null,4)],{type:"text/plain"});return(window.URL||window.webkitURL).createObjectURL(e)},t.prototype.deleteRules=function(){this.setModel({rules:[]}),this.setLocalData()},t}]),app.factory("Rule",function(){var e=function(e){this.name=null,this.url_fragment=null,this.tab={title:null,icon:null,pinned:!1,"protected":!1,unique:!1,muted:!1,url_matcher:null},angular.extend(this,e)};return e.prototype.setModel=function(e){angular.extend(this,e)},e}),app.controller("TabRulesController",["$scope","$mdDialog","$mdMedia","Rule","TabModifier",function(e,t,n,o,i){var l=new i;l.checkOldSettings(),l.getLocalData(),e.tab_modifier=l,e.showForm=function(e,i){var r=void 0===i?null:l.rules.indexOf(i);t.show({controller:"FormModalController",templateUrl:"../html/form.min.html",targetEvent:e,clickOutsideToClose:!0,fullscreen:n("md"),resolve:{rule:function(){return null===r?new o:i}}}).then(function(e){l.save(e,r)})},e.duplicate=function(e){l.save(new o(e))},e["delete"]=function(e,n){var o=t.confirm().clickOutsideToClose(!1).title("Delete rule").textContent("Do you really want to delete this rule?").ariaLabel("Delete rule").targetEvent(e).ok("Delete").cancel("Cancel");t.show(o).then(function(){l.removeRule(n)})}}]),app.controller("FormModalController",["$scope","$mdDialog","rule",function(e,t,n){e.rule=n,e.$watch("rule.url_fragment",function(){(""===n.url_fragment||void 0===n.url_fragment)&&n.setModel({url_fragment:null})}),e.$watch("rule.tab.title",function(){(""===n.tab.title||void 0===n.tab.title)&&(n.tab.title=null)}),e.$watch("rule.tab.icon",function(){(""===n.tab.icon||void 0===n.tab.icon)&&(n.tab.icon=null)}),e.$watch("rule.tab.url_matcher",function(){(""===n.tab.url_matcher||void 0===n.tab.url_matcher)&&(n.tab.url_matcher=null)}),e.closeForm=function(){t.cancel()},e.save=function(e){t.hide(e)}}]),app.controller("SettingsController",["$scope","TabModifier",function(e,t){var n=new t;n.getLocalData(),e.json_url=n["export"](),e["import"]=function(e){var t=n["import"](e);if(t===!0)document.getElementById("settings").value="";else switch(n["import"](e)){case"INVALID_JSON_FORMAT":alert("Invalid JSON file. Please check it on jsonlint.com.");break;case"INVALID_SETTINGS":alert("Invalid settings file. Is this file comes from Tab Modifier?")}},e.deleteRules=function(){confirm("Are your sure?")===!0&&n.deleteRules()}}]);