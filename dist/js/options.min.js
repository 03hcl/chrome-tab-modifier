var app=angular.module("TabModifier",["ngRoute","ngAnimate","ngAria","ngMaterial","angular-google-analytics"]);app.config(["$routeProvider","$compileProvider","$mdIconProvider","$mdThemingProvider","AnalyticsProvider",function(e,t,o,i,n){t.aHrefSanitizationWhitelist(/^\s*(https?|chrome-extension|file|blob):/),t.imgSrcSanitizationWhitelist(/^\s*(https?|chrome-extension|file|blob):|data:image\//),o.icon("menu","/icons/menu.svg").icon("backup-restore","/icons/backup-restore.svg").icon("information-outline","/icons/information-outline.svg").icon("alert","/icons/alert.svg").icon("file-import","/icons/file-import.svg").icon("file-export","/icons/file-export.svg").icon("file-outline","/icons/file-outline.svg").icon("options-vertical","/icons/dots-vertical.svg").icon("close","/icons/close.svg").icon("plus","/icons/plus.svg").icon("image","/icons/image.svg").icon("save","/icons/content-save.svg").icon("tab","/icons/checkbox-multiple-marked-outline.svg").icon("list","/icons/format-list-bulleted.svg").icon("tab","/icons/tab.svg").icon("list-plus","/icons/playlist-plus.svg").icon("clear","/icons/eraser.svg").icon("settings","/icons/settings.svg").icon("duplicate","/icons/content-copy.svg").icon("delete","/icons/delete.svg").icon("edit","/icons/pencil.svg").icon("google-chrome","/icons/google-chrome.svg").icon("github-circle","/icons/github-circle.svg").icon("help","/icons/help-circle.svg").icon("credit-card","/icons/credit-card.svg"),i.theme("default").primaryPalette("blue",{"default":"600"}).accentPalette("yellow",{"default":"700"}).warnPalette("red",{"default":"A700"}),n.setAccount("UA-27524593-7"),n.setHybridMobileSupport(!0),n.setDomainName("none");var l={"/":{templateUrl:"/html/tab_rules.min.html",controller:"TabRulesController"},"/settings":{templateUrl:"/html/settings.min.html",controller:"SettingsController"},"/help":{templateUrl:"/html/help.min.html",controller:"HelpController"}};for(var r in l)l.hasOwnProperty(r)&&e.when(r,l[r])}]),app.run(["$rootScope","$location","Analytics",function(e,t,o){e.location=t}]),app.service("GitHubService",["$http",function(e){this.getLatestRelease=function(){return e.get("https://api.github.com/repos/sylouuu/chrome-tab-modifier/releases/latest")}}]),app.service("TabModifierService",["$http",function(e){this.getManifestFile=function(){return e.get("/manifest.json")}}]),app.directive("inputFileButton",function(){return{restrict:"E",link:function(e,t){var o=t.find("button"),i=t.find("input");i.css({display:"none"}),o.bind("click",function(){i[0].click()})}}}),app.directive("onReadFile",["$parse",function(e){return{restrict:"A",scope:!1,link:function(t,o,i){var n=e(i.onReadFile);o.on("change",function(e){var o=new FileReader;o.onload=function(e){t.$apply(function(){n(t,{$fileContent:e.target.result})})},o.readAsText((e.srcElement||e.target).files[0])})}}}]),app.controller("HelpController",function(){}),app.controller("MainController",["$scope","$mdSidenav","$q","Analytics","TabModifierService","GitHubService",function(e,t,o,i,n,l){e.toggleSideNav=function(){t("aside-left").toggle(),i.trackEvent("sidenav","toggle")},e.closeSideNav=function(){t("aside-left").isOpen()===!0&&(t("aside-left").close(),i.trackEvent("sidenav","close"))}}]),app.controller("SettingsController",["$scope","$mdDialog","$mdToast","$location","TabModifier","Analytics",function(e,t,o,i,n,l){var r=new n;chrome.storage.local.get("tab_modifier",function(t){void 0!==t.tab_modifier&&(r.build(t.tab_modifier),e.tab_modifier=r,e.json_url=r["export"]())}),e["import"]=function(e){var n=r.checkFileBeforeImport(e);if(n===!0)document.getElementById("settings").value="",r["import"](e).sync(),i.path("/"),o.show(o.simple().textContent("Your tab rules have been successfully imported").position("top right")),l.trackEvent("tab-rules","import-success");else{var c;switch(n){case"INVALID_JSON_FORMAT":c="Invalid JSON file. Please check it on jsonlint.com.",l.trackEvent("tab-rules","import-error-json");break;case"INVALID_SETTINGS":c="Invalid settings file. Is this file comes from Tab Modifier?",l.trackEvent("tab-rules","import-error-format")}t.show(t.alert().clickOutsideToClose(!0).title("Failed to import tab rules").textContent(c).ariaLabel("Failed to import tab rules").ok("OK, sorry"))}},e.deleteRules=function(e){var i=t.confirm().clickOutsideToClose(!1).title("Delete all").textContent("Do you really want to delete all of your tab rules?").ariaLabel("Delete all").targetEvent(e).ok("Delete all").cancel("Cancel");t.show(i).then(function(){r.deleteRules().sync(),o.show(o.simple().textContent("Your tab rules have been successfully deleted").position("top right")),l.trackEvent("tab-rules","delete-all")})}}]),app.controller("TabRulesController",["$scope","$mdDialog","$mdMedia","$mdToast","Rule","TabModifier","Analytics","$http",function(e,t,o,i,n,l,r,c){var s=new l,a=[];c.get("/js/icons.min.json").then(function(e){a=e.data}),chrome.storage.sync.get("tab_modifier",function(e){void 0!==e.tab_modifier&&null!==e.tab_modifier&&(s.build(e.tab_modifier),s.sync()),chrome.storage.sync.clear()}),chrome.storage.local.get("tab_modifier",function(t){void 0!==t.tab_modifier&&s.build(t.tab_modifier),e.tab_modifier=s}),e.showForm=function(e,l){var c=void 0===l?null:s.rules.indexOf(l);t.show({controller:"FormModalController",templateUrl:"../html/form.min.html",targetEvent:e,clickOutsideToClose:!0,fullscreen:o("xs"),resolve:{icon_list:function(){return a},rule:function(){return null===c?new n:l}}}).then(function(e){s.save(e,c),s.sync(),i.show(i.simple().textContent("Your rule has been successfully saved").position("top right"))},function(){r.trackEvent("tab-rules","close-form")})},e.duplicate=function(e){s.save(new n(angular.copy(e))),s.sync(),i.show(i.simple().textContent("Your rule has been successfully duplicated").position("top right"))},e["delete"]=function(e,o){var n=t.confirm().clickOutsideToClose(!1).title("Delete rule").textContent("Do you really want to delete this rule?").ariaLabel("Delete rule").targetEvent(e).ok("Delete").cancel("Cancel");t.show(n).then(function(){s.removeRule(o),s.sync(),i.show(i.simple().textContent("Your rule has been successfully deleted").position("top right"))})}}]),app.controller("FormModalController",["$scope","$mdDialog","rule","icon_list",function(e,t,o,i){e.rule=o,e.icon_list=i,e.$watch("rule.url_fragment",function(){""!==o.url_fragment&&void 0!==o.url_fragment||o.setModel({url_fragment:null})}),e.$watch("rule.tab.title",function(){""!==o.tab.title&&void 0!==o.tab.title||(o.tab.title=null)}),e.$watch("rule.tab.icon",function(){""!==o.tab.icon&&void 0!==o.tab.title||(o.tab.icon=null)}),e.$watch("rule.tab.url_matcher",function(){""!==o.tab.url_matcher&&void 0!==o.tab.url_matcher||(o.tab.url_matcher=null)}),e.closeForm=function(){t.cancel()},e.save=function(e){t.hide(e)}}]),app.factory("Rule",function(){var e=function(e){this.name=null,this.url_fragment=null,this.tab={title:null,icon:null,pinned:!1,"protected":!1,unique:!1,muted:!1,url_matcher:null},angular.extend(this,e)};return e.prototype.setModel=function(e){angular.extend(this,e)},e}),app.factory("TabModifier",["Rule",function(e){var t=function(e){this.rules=[],angular.extend(this,e)};return t.prototype.setModel=function(e){angular.extend(this,e)},t.prototype.addRule=function(e){this.rules.push(e)},t.prototype.removeRule=function(e){this.rules.splice(this.rules.indexOf(e),1)},t.prototype.save=function(e,t){null===t||void 0===t?this.addRule(e):this.rules[t]=e},t.prototype.build=function(t){var o=this;this.deleteRules(),angular.forEach(t.rules,function(t){o.addRule(new e(t))})},t.prototype.sync=function(){chrome.storage.local.set({tab_modifier:this})},t.prototype.checkFileBeforeImport=function(e){if(void 0!==e){try{var t=JSON.parse(e);if("rules"in t==!1)return"INVALID_SETTINGS"}catch(o){return"INVALID_JSON_FORMAT"}return!0}return!1},t.prototype["import"]=function(e){return this.build(JSON.parse(e)),this},t.prototype["export"]=function(){var e=new Blob([JSON.stringify(this,null,4)],{type:"text/plain"});return(window.URL||window.webkitURL).createObjectURL(e)},t.prototype.deleteRules=function(){return this.setModel({rules:[]}),this},t}]);