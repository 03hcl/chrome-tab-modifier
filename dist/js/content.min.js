var Tab=function(e,t,n){var i=null,l=null,r={title:null,icon:null,pinned:null,"protected":null,unique:null,url_matcher:null};for(var u in n)if(-1!==e.indexOf(u)){i=u,r.title=n[u].title||null,r.icon=n[u].icon||null,r.pinned=n[u].pinned||null,r["protected"]=n[u]["protected"]||null,r.unique=n[u].unique||null,r.url_matcher=n[u].url_matcher||null;break}return getMatch=function(){return i},getTitle=function(){return l},getIcon=function(){return r.icon},getPinned=function(){return r.pinned},getProtected=function(){return r["protected"]},getUnique=function(){return r.unique},setCurrentTitle=function(e){t=e},setTitle=function(){if(null!==r.title&&(l=-1!==r.title.indexOf("{title}")?r.title.replace("{title}",t):r.title),null!==r.url_matcher){var n=e.match(r.url_matcher);if(null!==n)for(var i=0;i<=n.length;i++)l=l.replace("$"+i,n[i]||"")}},{getMatch:getMatch,getTitle:getTitle,getIcon:getIcon,getPinned:getPinned,getProtected:getProtected,getUnique:getUnique,setCurrentTitle:setCurrentTitle,setTitle:setTitle}},w=window;chrome.runtime.sendMessage({method:"getSettings"},function(e){if(void 0!==e&&void 0!==e.settings){var t,n=new Tab(location.href,document.title,JSON.parse(e.settings)),i=!1;if(n.setTitle(),null!==n.getTitle()&&(document.title=n.getTitle()),t=new window.WebKitMutationObserver(function(e){i===!0?i=!1:e.forEach(function(e){n.setCurrentTitle(e.target.textContent),n.setTitle(),null!==n.getTitle()&&(document.title=n.getTitle()),i=!0})}),t.observe(document.querySelector("head > title"),{subtree:!0,characterresponse:!0,childList:!0}),n.getPinned()===!0&&chrome.runtime.sendMessage({method:"setPinned",tab_id:e.tab_id}),null!==n.getIcon()){var l,r,u;l=document.querySelectorAll('head link[rel*="icon"]'),Array.prototype.forEach.call(l,function(e){e.parentNode.removeChild(e)}),r="{default}"===n.getIcon()?chrome.extension.getURL("/img/default_favicon.png"):n.getIcon(),u=document.createElement("link"),u.type="image/x-icon",u.rel="icon",u.href=r,document.getElementsByTagName("head")[0].appendChild(u)}n.getProtected()===!0&&(w.onbeforeunload=function(){return""}),n.getUnique()===!0&&chrome.runtime.sendMessage({method:"setUnique",match:n.getMatch(),tab_id:e.tab_id})}});