var Tab=function(e,t,n){for(var r,i=null,l={title:null,icon:null,pinned:null,"protected":null,unique:null,url_matcher:null},u=0;u<n.rules.length;u++)if(r=n.rules[u],-1!==e.indexOf(r.url_fragment)){l=r;break}return getUrlFragment=function(){return l.url_fragment},getRuleName=function(){return l.name},getTitle=function(){return i},getIcon=function(){return l.tab.icon},getPinned=function(){return l.tab.pinned},getProtected=function(){return l.tab["protected"]},getUnique=function(){return l.tab.unique},setCurrentTitle=function(e){t=e},setTitle=function(){if(null!==l.tab.title&&(i=-1!==l.tab.title.indexOf("{title}")?l.tab.title.replace("{title}",t):l.tab.title),null!==l.tab.url_matcher){var n=e.match(l.tab.url_matcher);if(null!==n)for(var r=0;r<=n.length;r++)i=i.replace("$"+r,n[r]||"")}},{getUrlFragment:getUrlFragment,getTitle:getTitle,getIcon:getIcon,getPinned:getPinned,getProtected:getProtected,getUnique:getUnique,setCurrentTitle:setCurrentTitle,setTitle:setTitle}},w=window;chrome.runtime.sendMessage({method:"getRules"},function(e){if(void 0!==e&&void 0!==e.tab_modifier){var t,n=new Tab(location.href,document.title,JSON.parse(e.tab_modifier)),r=!1;if(n.setTitle(),null!==n.getTitle()&&(document.title=n.getTitle()),t=new window.WebKitMutationObserver(function(e){r===!0?r=!1:e.forEach(function(e){n.setCurrentTitle(e.target.textContent),n.setTitle(),null!==n.getTitle()&&(document.title=n.getTitle()),r=!0})}),t.observe(document.querySelector("head > title"),{subtree:!0,characterresponse:!0,childList:!0}),n.getPinned()===!0&&chrome.runtime.sendMessage({method:"setPinned",tab_id:e.tab_id}),null!==n.getIcon()){var i,l,u;i=document.querySelectorAll('head link[rel*="icon"]'),Array.prototype.forEach.call(i,function(e){e.parentNode.removeChild(e)}),l="{default}"===n.getIcon()?chrome.extension.getURL("/img/default_favicon.png"):n.getIcon(),u=document.createElement("link"),u.type="image/x-icon",u.rel="icon",u.href=l,document.getElementsByTagName("head")[0].appendChild(u)}n.getProtected()===!0&&(w.onbeforeunload=function(){return""}),n.getUnique()===!0&&chrome.runtime.sendMessage({method:"setUnique",match:n.getUrlFragment(),tab_id:e.tab_id})}});