var w=window;chrome.runtime.sendMessage({method:"getRules"},function(e){if(void 0!==e&&void 0!==e.tab_modifier){for(var t=JSON.parse(e.tab_modifier),n=null,r=0;r<t.rules.length;r++)if(-1!==location.href.indexOf(t.rules[r].url_fragment)){n=t.rules[r];break}if(null!==n){var a=function(e,t){var r=n.tab.title;if(r=-1!==n.tab.title.indexOf("{title}")?n.tab.title.replace("{title}",t):n.tab.title,null!==n.tab.url_matcher){var a=e.match(n.tab.url_matcher);if(null!==a)for(var i=0;i<=a.length;i++)r=r.replace("$"+i,a[i]||"")}return r};null!==n.tab.title&&(document.title=a(location.href,document.title));var i,l=!1;if(i=new window.WebKitMutationObserver(function(e){l===!0?l=!1:e.forEach(function(e){null!==n.tab.title&&(document.title=a(location.href,e.target.textContent)),l=!0})}),i.observe(document.querySelector("head > title"),{subtree:!0,characterresponse:!0,childList:!0}),n.tab.pinned===!0&&chrome.runtime.sendMessage({method:"setPinned",tab_id:e.tab_id}),null!==n.tab.icon){var o,u,d;o=document.querySelectorAll('head link[rel*="icon"]'),Array.prototype.forEach.call(o,function(e){e.parentNode.removeChild(e)}),u="{default}"===n.tab.icon?chrome.extension.getURL("/img/default_favicon.png"):n.tab.icon,d=document.createElement("link"),d.type="image/x-icon",d.rel="icon",d.href=u,document.getElementsByTagName("head")[0].appendChild(d)}n.tab["protected"]===!0&&(w.onbeforeunload=function(){return""}),n.tab.unique===!0&&chrome.runtime.sendMessage({method:"setUnique",url_fragment:t.url_fragment(),tab_id:e.tab_id}),n.tab.muted===!0&&chrome.runtime.sendMessage({method:"setMuted",tab_id:e.tab_id})}}});