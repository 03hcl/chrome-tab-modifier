var w=window;chrome.runtime.sendMessage({method:"getRules"},function(e){if(void 0!==e&&void 0!==e.tab_modifier){for(var t=JSON.parse(e.tab_modifier),n=null,r=0;r<t.rules.length;r++)if(-1!==location.href.indexOf(t.rules[r].url_fragment)){n=t.rules[r];break}if(null!==n){var i=function(e,t){var r=-1!==n.tab.title.indexOf("{title}")?n.tab.title.replace("{title}",t):n.tab.title;if(null!==n.tab.url_matcher){var i=e.match(n.tab.url_matcher);if(null!==i)for(var a=0;a<=i.length;a++)r=r.replace("$"+a,i[a]||"")}return r};null!==n.tab.title&&(document.title=i(location.href,document.title));var a,o=!1;if(a=new window.WebKitMutationObserver(function(e){o===!0?o=!1:e.forEach(function(e){null!==n.tab.title&&(document.title=i(location.href,e.target.textContent)),o=!0})}),a.observe(document.querySelector("head > title"),{subtree:!0,characterresponse:!0,childList:!0}),n.tab.pinned===!0&&chrome.runtime.sendMessage({method:"setPinned",tab_id:e.tab_id}),null!==n.tab.icon){var l,u,d;l=document.querySelectorAll('head link[rel*="icon"]'),Array.prototype.forEach.call(l,function(e){e.parentNode.removeChild(e)}),u=-1===n.tab.icon.indexOf("http")?chrome.extension.getURL("/img/"+n.tab.icon):n.tab.icon,d=document.createElement("link"),d.type="image/x-icon",d.rel="icon",d.href=u,document.getElementsByTagName("head")[0].appendChild(d)}n.tab["protected"]===!0&&(w.onbeforeunload=function(){return""}),n.tab.unique===!0&&chrome.runtime.sendMessage({method:"setUnique",url_fragment:n.url_fragment,tab_id:e.tab_id}),n.tab.muted===!0&&chrome.runtime.sendMessage({method:"setMuted",tab_id:e.tab_id})}}});