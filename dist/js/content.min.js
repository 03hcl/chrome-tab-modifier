var Tab=function(e,t,n){for(var i,r=null,l={name:null,tab:{title:null,icon:null,pinned:null,"protected":null,unique:null,url_matcher:null}},u=0;u<n.rules.length;u++)if(i=n.rules[u],-1!==e.indexOf(i.url_fragment)){l=i;break}return getUrlFragment=function(){return l.url_fragment},getRuleName=function(){return l.name},getTitle=function(){return r},getIcon=function(){return l.tab.icon},getPinned=function(){return l.tab.pinned},getProtected=function(){return l.tab["protected"]},getUnique=function(){return l.tab.unique},setCurrentTitle=function(e){t=e},setTitle=function(){if(void 0!==l.tab&&null!==l.tab.title&&(r=-1!==l.tab.title.indexOf("{title}")?l.tab.title.replace("{title}",t):l.tab.title),void 0!==l.tab&&null!==l.tab.url_matcher){var n=e.match(l.tab.url_matcher);if(null!==n)for(var i=0;i<=n.length;i++)r=r.replace("$"+i,n[i]||"")}},{getUrlFragment:getUrlFragment,getTitle:getTitle,getIcon:getIcon,getPinned:getPinned,getProtected:getProtected,getUnique:getUnique,setCurrentTitle:setCurrentTitle,setTitle:setTitle}},w=window;chrome.runtime.sendMessage({method:"getRules"},function(e){if(void 0!==e&&void 0!==e.tab_modifier){var t,n=new Tab(location.href,document.title,JSON.parse(e.tab_modifier)),i=!1;if(n.setTitle(),null!==n.getTitle()&&(document.title=n.getTitle()),t=new window.WebKitMutationObserver(function(e){i===!0?i=!1:e.forEach(function(e){n.setCurrentTitle(e.target.textContent),n.setTitle(),null!==n.getTitle()&&(document.title=n.getTitle()),i=!0})}),t.observe(document.querySelector("head > title"),{subtree:!0,characterresponse:!0,childList:!0}),n.getPinned()===!0&&chrome.runtime.sendMessage({method:"setPinned",tab_id:e.tab_id}),null!==n.getIcon()){var r,l,u;r=document.querySelectorAll('head link[rel*="icon"]'),Array.prototype.forEach.call(r,function(e){e.parentNode.removeChild(e)}),l="{default}"===n.getIcon()?chrome.extension.getURL("/img/default_favicon.png"):n.getIcon(),u=document.createElement("link"),u.type="image/x-icon",u.rel="icon",u.href=l,document.getElementsByTagName("head")[0].appendChild(u)}n.getProtected()===!0&&(w.onbeforeunload=function(){return""}),n.getUnique()===!0&&chrome.runtime.sendMessage({method:"setUnique",match:n.getUrlFragment(),tab_id:e.tab_id})}});