var Tab=function(e,t,n){var i=null,l=null,r={title:null,icon:null,pinned:null,"protected":null,unique:null,url_matcher:null};for(var u in n)if(-1!==e.indexOf(u)){i=u,r.title=n[u].title||null,r.icon=n[u].icon||null,r.pinned=n[u].pinned||null,r["protected"]=n[u]["protected"]||null,r.unique=n[u].unique||null,r.url_matcher=n[u].url_matcher||null;break}return getMatch=function(){return i},getTitle=function(){return l},getIcon=function(){return r.icon},getPinned=function(){return r.pinned},getProtected=function(){return r["protected"]},getUnique=function(){return r.unique},setCurrentTitle=function(e){t=e},setTitle=function(){if(null!==r.title&&(l=-1!==r.title.indexOf("{title}")?r.title.replace("{title}",t):r.title),null!==r.url_matcher){var n=e.match(r.url_matcher);if(null!==n)for(var i=0;i<=n.length;i++)l=l.replace("$"+i,n[i]||"")}},{getMatch:getMatch,getTitle:getTitle,getIcon:getIcon,getPinned:getPinned,getProtected:getProtected,getUnique:getUnique,setCurrentTitle:setCurrentTitle,setTitle:setTitle}},w=window;chrome.runtime.sendMessage({method:"getSettings"},function(e){var t=e.data;if(void 0!==t&&void 0!==t.settings){var n,i=new Tab(location.href,document.title,JSON.parse(t.settings)),l=!1;if(i.setTitle(),null!==i.getTitle()&&(document.title=i.getTitle()),n=new window.WebKitMutationObserver(function(e){l===!0?l=!1:e.forEach(function(e){i.setCurrentTitle(e.target.textContent),i.setTitle(),null!==i.getTitle()&&(document.title=i.getTitle()),l=!0})}),n.observe(document.querySelector("head > title"),{subtree:!0,characterData:!0,childList:!0}),i.getPinned()===!0&&chrome.runtime.sendMessage({method:"setPinned",tab_id:t.tab_id}),null!==i.getIcon()){var r,u,o;r=document.querySelectorAll('head link[rel*="icon"]'),Array.prototype.forEach.call(r,function(e){e.parentNode.removeChild(e)}),u="{default}"===i.getIcon()?chrome.extension.getURL("/img/default_favicon.png"):i.getIcon(),o=document.createElement("link"),o.type="image/x-icon",o.rel="icon",o.href=u,document.getElementsByTagName("head")[0].appendChild(o)}i.getProtected()===!0&&(w.onbeforeunload=function(){return""}),i.getUnique()===!0&&chrome.runtime.sendMessage({method:"setUnique",match:i.getMatch(),tab_id:t.tab_id})}});